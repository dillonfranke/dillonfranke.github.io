<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite | Dillon Franke Security</title><meta name=keywords content><meta name=description content="Background Protocol Buffers (Protobufs) are a language agnostic data serialization format that allow data to be safely and efficiently trasmitted or stored. Protobuf usage has exploded within the past several years. When testing web applications, mobile applications, and embedded devices alike, it&rsquo;s increasingly likely you&rsquo;ll encounter Protobuf data within requests like this:
A normal binary Protobuf request
You might have logically tried to fuzz these inputs as you would any other parameter, only to realize that things weren&rsquo;t as simple as they appeared:"><meta name=author content><link rel=canonical href=https://www.dillonfrankesecurity.com/posts/protoburp-encode-custom-protobuf-messages-in-burp/><link crossorigin=anonymous href=/assets/css/stylesheet.079aad7745c411ac345789fa53c1b3ab000831a82f52c67495460251a10413d4.css integrity="sha256-B5qtd0XEEaw0V4n6U8GzqwAIMagvUsZ0lUYCUaEEE9Q=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.dillonfrankesecurity.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.dillonfrankesecurity.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.dillonfrankesecurity.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.dillonfrankesecurity.com/apple-touch-icon.png><link rel=mask-icon href=https://www.dillonfrankesecurity.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script defer data-domain=dillonfrankesecurity.com src=https://plausible.io/js/script.js></script><meta property="og:title" content="ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite"><meta property="og:description" content="Background Protocol Buffers (Protobufs) are a language agnostic data serialization format that allow data to be safely and efficiently trasmitted or stored. Protobuf usage has exploded within the past several years. When testing web applications, mobile applications, and embedded devices alike, it&rsquo;s increasingly likely you&rsquo;ll encounter Protobuf data within requests like this:
A normal binary Protobuf request
You might have logically tried to fuzz these inputs as you would any other parameter, only to realize that things weren&rsquo;t as simple as they appeared:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.dillonfrankesecurity.com/posts/protoburp-encode-custom-protobuf-messages-in-burp/"><meta property="og:image" content="https://www.dillonfrankesecurity.com/introducing-protoburp.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-02T14:22:41-07:00"><meta property="article:modified_time" content="2023-08-02T14:22:41-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.dillonfrankesecurity.com/introducing-protoburp.png"><meta name=twitter:title content="ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite"><meta name=twitter:description content="Background Protocol Buffers (Protobufs) are a language agnostic data serialization format that allow data to be safely and efficiently trasmitted or stored. Protobuf usage has exploded within the past several years. When testing web applications, mobile applications, and embedded devices alike, it&rsquo;s increasingly likely you&rsquo;ll encounter Protobuf data within requests like this:
A normal binary Protobuf request
You might have logically tried to fuzz these inputs as you would any other parameter, only to realize that things weren&rsquo;t as simple as they appeared:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.dillonfrankesecurity.com/posts/"},{"@type":"ListItem","position":3,"name":"ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite","item":"https://www.dillonfrankesecurity.com/posts/protoburp-encode-custom-protobuf-messages-in-burp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite","name":"ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite","description":"Background Protocol Buffers (Protobufs) are a language agnostic data serialization format that allow data to be safely and efficiently trasmitted or stored. Protobuf usage has exploded within the past several years. When testing web applications, mobile applications, and embedded devices alike, it\u0026rsquo;s increasingly likely you\u0026rsquo;ll encounter Protobuf data within requests like this:\nA normal binary Protobuf request\nYou might have logically tried to fuzz these inputs as you would any other parameter, only to realize that things weren\u0026rsquo;t as simple as they appeared:","keywords":[],"articleBody":"Background Protocol Buffers (Protobufs) are a language agnostic data serialization format that allow data to be safely and efficiently trasmitted or stored. Protobuf usage has exploded within the past several years. When testing web applications, mobile applications, and embedded devices alike, it’s increasingly likely you’ll encounter Protobuf data within requests like this:\nA normal binary Protobuf request\nYou might have logically tried to fuzz these inputs as you would any other parameter, only to realize that things weren’t as simple as they appeared:\nNaively fuzzing binary protobuf data doesn’t work\nAdditionally, you might have discovered a Protobuf definition (.proto) file like the one below and wondered how you could use such a file to send valid, fuzzable requests. If so, ProtoBurp was made for you ❤️\nsyntax = \"proto3\"; package tutorial; message Person { string name = 1; int32 id = 2; string email = 3; enum PhoneType { PHONE_TYPE_UNSPECIFIED = 0; PHONE_TYPE_MOBILE = 1; PHONE_TYPE_HOME = 2; PHONE_TYPE_WORK = 3; } message PhoneNumber { string number = 1; PhoneType type = 2; } repeated PhoneNumber phones = 4; } message AddressBook { repeated Person people = 1; } Introducing ProtoBurp ProtoBurp is a Burp Suite extension that enables security researchers to encode and fuzz custom Protobuf messages. It allows users to automatically convert JSON data into a Protobuf message based on a provided protobuf definition file. This opens up opportunities for fuzzing inputs using Burp’s Repeater and Intruder tools, as well as proxy traffic from other tools (e.g. sqlmap).\nProtoBurp converts JSON data into a valid Protobuf\nHow do I use ProtoBurp? The magic behind ProtoBurp lies in its ability to dynamically create Protobuf messages based on provided JSON input and a Protobuf definition file.\nThe ProtoBurp extension tab in Burp Suite\nInstall ProtoBurp and its dependencies (see the GitHub repository) Create or obtain a .proto file you’d like to use to serialize Protobuf messages (examples are in the test_app folder). Use the protoc utility to compile your .proto file into Python format protoc --python_out=./ MyMessage.proto Click the ‘Choose File’ button to select your compiled protobuf file. Check the ‘Enable ProtoBurp’ checkbox. All requests sent with the header ProtoBurp: True will then be converted from JSON to a Protobuf! Usage with Intruder Once you have ProtoBurp set up, you can fuzz Protobuf inputs with Burp just like you would any other parameter! For example, to fuzz the number field we’ve seen in the previous examples, we can just send our JSON payload request to Intruder:\nBurp Suite Intruder usage\nFor each fuzzed request Intruder makes, ProtoBurp will handle the conversion from JSON into Protobuf format:\nIntruder requests converted into Protobuf data\nNote: The modified requests won’t show up in Burp’s proxy history. You’ll need to view the outgoing requests using Burp’s Logger or an extension like Logger++, as I did above.\nUsage with sqlmap (or any external tool) Possibly the largest motivator for creating ProtoBurp was to generate a way to seamlessly use external security tools on Protobuf inputs. For example, during one web application assessment, I identified an OR-based SQL injection in a Protobuf field, as shown below.\nSuccessful OR-based SQL injection\nNormally, my next step would be to pass this request to sqlmap and have the database fully dumped within 30 minutes. However, I couldn’t do this because of the pesky Protobufs.\nBut now enter ProtoBurp. It is now possible to give sqlmap a JSON payload to test its payloads and let ProtoBurp handle the Protobuf encoding. We can now use the following command:\nsqlmap -u http://chickenblasters.com:5000 --force-ssl --level 5 --risk 3 -H \"ProtoBurp: true\" --batch --proxy=http://localhost:8080 --data='{\"people\":[{\"name\":\"JohnDoe\",\"id\":1,\"email\":\"john.doe@example.com\",\"phones\":[{\"number\":\"1234567890*\",\"type\":\"PHONE_TYPE_MOBILE\"},{\"number\":\"0987654321\",\"type\":\"PHONE_TYPE_HOME\"}]}]}' Note: Make sure to set pass the ProtoBurp: True header!\nAll proxy traffic from sqlmap is then converted by ProtoBurp:\nSqlmap payloads converted by ProtoBurp\nGenerating a JSON payload You might be wondering: “How can I generate a JSON object from a .proto file to use with ProtoBurp?”\nEasy, I wrote a script that, given a .proto file, will fill in placeholder values to generate a JSON payload. You can then use the JSON payload with ProtoBurp. Here’s how you use the script:\n❯ python3 json-generator.py Usage: python3 json-generator.py ❯ python3 json-generator.py test_app/addressbook_pb2.py AddressBook { \"people\": [ { \"name\": \"example\", \"id\": 1, \"email\": \"example\", \"phones\": [ { \"number\": \"example\", \"type\": \"PHONE_TYPE_UNSPECIFIED\" }, { \"number\": \"example\", \"type\": \"PHONE_TYPE_UNSPECIFIED\" } ] }, { \"name\": \"example\", \"id\": 1, \"email\": \"example\", \"phones\": [ { \"number\": \"example\", \"type\": \"PHONE_TYPE_UNSPECIFIED\" }, { \"number\": \"example\", \"type\": \"PHONE_TYPE_UNSPECIFIED\" } ] } ] } What about existing tooling? I’ve used the blackboxprotobuf Burp extension for years, which aids in the decoding, editing, and re-encoding of Protobuf messages without known .proto files. For example, the figure below shows the Protobuf from above decoded by blackboxprotobuf.\nThe Blackboxprotobuf extension in action\nWhile it is an excellent tool, one of blackboxprotobuf’s notable limitations is the fact that it can only send protobuf messages it has previously seen through Burp Suite’s proxy. Sometimes, however, researchers want to send new protobuf messages, either because we want to fuzz them, or we know the format of a specific message.\nProtoBurp solves two novel problems:\nThe ability to send new protobuf messages that weren’t already seen through proxy traffic Operability with Burp Intruder and other extensions to fuzz protobuf inputs ProtoBurp GitHub Repository You can access ProtoBurp, the JSON generator script, and a test application that accepts Protobufs here. Detailed installation and usage instructions are also included.\nPlease submit any bugs or feature requests to ProtoBurp’s issue tracker.\nThanks for reading, and I wish you much success testing Protobufs!\n","wordCount":"926","inLanguage":"en","image":"https://www.dillonfrankesecurity.com/introducing-protoburp.png","datePublished":"2023-08-02T14:22:41-07:00","dateModified":"2023-08-02T14:22:41-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.dillonfrankesecurity.com/posts/protoburp-encode-custom-protobuf-messages-in-burp/"},"publisher":{"@type":"Organization","name":"Dillon Franke Security","logo":{"@type":"ImageObject","url":"https://www.dillonfrankesecurity.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.dillonfrankesecurity.com accesskey=h title="Dillon Franke Security (Alt + H)">Dillon Franke Security</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.dillonfrankesecurity.com/ title=Home><span>Home</span></a></li><li><a href=https://www.dillonfrankesecurity.com/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://www.dillonfrankesecurity.com/presentations/ title=Presentations><span>Presentations</span></a></li><li><a href=https://www.dillonfrankesecurity.com/services/ title=Services><span>Services</span></a></li><li><a href=https://www.dillonfrankesecurity.com/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>ProtoBurp: Encode and Fuzz Custom Protobuf Messages in Burp Suite</h1><div class=post-meta><span title='2023-08-02 14:22:41 -0700 -0700'>August 2, 2023</span>&nbsp;·&nbsp;5 min</div></header><figure class=entry-cover><img loading=lazy src=https://www.dillonfrankesecurity.com/introducing-protoburp.png alt></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#introducing-protoburp aria-label="Introducing ProtoBurp">Introducing ProtoBurp</a><ul><li><a href=#how-do-i-use-protoburp aria-label="How do I use ProtoBurp?">How do I use ProtoBurp?</a><ul><li><a href=#usage-with-intruder aria-label="Usage with Intruder">Usage with Intruder</a></li><li><a href=#usage-with-sqlmap-or-any-external-tool aria-label="Usage with sqlmap (or any external tool)">Usage with sqlmap (or any external tool)</a></li><li><a href=#generating-a-json-payload aria-label="Generating a JSON payload">Generating a JSON payload</a></li></ul></li><li><a href=#what-about-existing-tooling aria-label="What about existing tooling?">What about existing tooling?</a></li></ul></li><li><a href=#protoburp-github-repository aria-label="ProtoBurp GitHub Repository">ProtoBurp GitHub Repository</a></li></ul></div></details></div><div class=post-content><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><p>Protocol Buffers (Protobufs) are a language agnostic data serialization format that allow data to be safely and efficiently trasmitted or stored. Protobuf usage has exploded within the past several years. When testing web applications, mobile applications, and embedded devices alike, it&rsquo;s increasingly likely you&rsquo;ll encounter Protobuf data within requests like this:</p><figure><img loading=lazy src=/normal-protobuf-binary-request.png alt="Normal binary Protobuf request"><figcaption><p>A normal binary Protobuf request</p></figcaption></figure><p>You might have logically tried to fuzz these inputs as you would any other parameter, only to realize that things weren&rsquo;t as simple as they appeared:</p><figure><img loading=lazy src=/naively-fuzzing-protobuf-binary-data.png alt="Naively fuzzing binary Protobuf data"><figcaption><p>Naively fuzzing binary protobuf data doesn&rsquo;t work</p></figcaption></figure><p>Additionally, you might have discovered a Protobuf definition (<code>.proto</code>) file like the one below and wondered how you could use such a file to send valid, fuzzable requests. If so, <code>ProtoBurp</code> was made for you ❤️</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#f92672>package</span> tutorial;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Person</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> name <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>int32</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>string</span> email <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>enum</span> PhoneType {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    PHONE_TYPE_UNSPECIFIED <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    PHONE_TYPE_MOBILE <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    PHONE_TYPE_HOME <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    PHONE_TYPE_WORK <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>message</span> <span style=color:#a6e22e>PhoneNumber</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>string</span> number <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    PhoneType type <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>repeated</span> PhoneNumber phones <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>AddressBook</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#66d9ef>repeated</span> Person people <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h1 id=introducing-protoburp>Introducing ProtoBurp<a hidden class=anchor aria-hidden=true href=#introducing-protoburp>#</a></h1><p><code>ProtoBurp</code> is a Burp Suite extension that enables security researchers to encode and fuzz custom Protobuf messages. It allows users to automatically convert JSON data into a Protobuf message based on a provided protobuf definition file. This opens up opportunities for fuzzing inputs using Burp&rsquo;s Repeater and Intruder tools, as well as proxy traffic from other tools (e.g. <code>sqlmap</code>).</p><figure><img loading=lazy src=/protoburp-transformation.png alt="Protoburp's functionality"><figcaption><p>ProtoBurp converts JSON data into a valid Protobuf</p></figcaption></figure><h2 id=how-do-i-use-protoburp>How do I use ProtoBurp?<a hidden class=anchor aria-hidden=true href=#how-do-i-use-protoburp>#</a></h2><p>The magic behind <code>ProtoBurp</code> lies in its ability to dynamically create Protobuf messages based on provided JSON input and a Protobuf definition file.</p><figure><img loading=lazy src=/protoburp-extension-tab.png alt="Protoburp extension tab in Burp Suite"><figcaption><p>The ProtoBurp extension tab in Burp Suite</p></figcaption></figure><ol><li>Install ProtoBurp and its dependencies (see the <a href=https://github.com/dillonfranke/protoburp>GitHub repository</a>)</li><li>Create or obtain a <code>.proto</code> file you&rsquo;d like to use to serialize Protobuf messages (examples are in the <code>test_app</code> folder).</li><li>Use the <code>protoc</code> utility to compile your <code>.proto</code> file into Python format</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc --python_out<span style=color:#f92672>=</span>./ MyMessage.proto
</span></span></code></pre></div><ol start=4><li>Click the &lsquo;Choose File&rsquo; button to select your compiled protobuf file.</li><li>Check the &lsquo;Enable ProtoBurp&rsquo; checkbox.</li><li>All requests sent with the header <code>ProtoBurp: True</code> will then be converted from JSON to a Protobuf!</li></ol><h3 id=usage-with-intruder>Usage with Intruder<a hidden class=anchor aria-hidden=true href=#usage-with-intruder>#</a></h3><p>Once you have <code>ProtoBurp</code> set up, you can fuzz Protobuf inputs with Burp just like you would any other parameter! For example, to fuzz the <code>number</code> field we&rsquo;ve seen in the previous examples, we can just send our JSON payload request to Intruder:</p><figure><img loading=lazy src=/burp-intruder-usage.png alt="Burp Suite Intruder usage" height=600><figcaption><p>Burp Suite Intruder usage</p></figcaption></figure><p>For each fuzzed request Intruder makes, <code>ProtoBurp</code> will handle the conversion from JSON into Protobuf format:</p><figure><img loading=lazy src=/burp-intruder-usage-requests.png alt="Converted Intruder requests" height=600><figcaption><p>Intruder requests converted into Protobuf data</p></figcaption></figure><blockquote><p><strong>Note:</strong> The modified requests won&rsquo;t show up in Burp&rsquo;s proxy history. You&rsquo;ll need to view the outgoing requests using Burp&rsquo;s <code>Logger</code> or an extension like <code>Logger++</code>, as I did above.</p></blockquote><h3 id=usage-with-sqlmap-or-any-external-tool>Usage with sqlmap (or any external tool)<a hidden class=anchor aria-hidden=true href=#usage-with-sqlmap-or-any-external-tool>#</a></h3><p>Possibly the largest motivator for creating <code>ProtoBurp</code> was to generate a way to seamlessly use external security tools on Protobuf inputs. For example, during one web application assessment, I identified an OR-based SQL injection in a Protobuf field, as shown below.</p><figure><img loading=lazy src=/or-based-sql-injection.png alt="Successful OR-based SQLi"><figcaption><p>Successful OR-based SQL injection</p></figcaption></figure><p>Normally, my next step would be to pass this request to <code>sqlmap</code> and have the database fully dumped within 30 minutes. However, I couldn&rsquo;t do this because of the pesky Protobufs.</p><p>But now enter <code>ProtoBurp</code>. It is now possible to give <code>sqlmap</code> a JSON payload to test its payloads and let <code>ProtoBurp</code> handle the Protobuf encoding. We can now use the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sqlmap -u http://chickenblasters.com:5000 --force-ssl --level <span style=color:#ae81ff>5</span> --risk <span style=color:#ae81ff>3</span> -H <span style=color:#e6db74>&#34;ProtoBurp: true&#34;</span> --batch --proxy<span style=color:#f92672>=</span>http://localhost:8080 --data<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{&#34;people&#34;:[{&#34;name&#34;:&#34;JohnDoe&#34;,&#34;id&#34;:1,&#34;email&#34;:&#34;john.doe@example.com&#34;,&#34;phones&#34;:[{&#34;number&#34;:&#34;1234567890*&#34;,&#34;type&#34;:&#34;PHONE_TYPE_MOBILE&#34;},{&#34;number&#34;:&#34;0987654321&#34;,&#34;type&#34;:&#34;PHONE_TYPE_HOME&#34;}]}]}&#39;</span>
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: Make sure to set pass the <code>ProtoBurp: True</code> header!</p></blockquote><p>All proxy traffic from <code>sqlmap</code> is then converted by <code>ProtoBurp</code>:</p><figure><img loading=lazy src=/sqlmap-protoburp-success.png alt="Sqlmap ProtoBurp success" height=600><figcaption><p>Sqlmap payloads converted by ProtoBurp</p></figcaption></figure><h3 id=generating-a-json-payload>Generating a JSON payload<a hidden class=anchor aria-hidden=true href=#generating-a-json-payload>#</a></h3><p>You might be wondering: &ldquo;How can I generate a JSON object from a <code>.proto</code> file to use with <code>ProtoBurp</code>?&rdquo;</p><p>Easy, I wrote a script that, given a <code>.proto</code> file, will fill in placeholder values to generate a JSON payload. You can then use the JSON payload with <code>ProtoBurp</code>. Here&rsquo;s how you use the script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ python3 json-generator.py
</span></span><span style=display:flex><span>Usage: python3 json-generator.py &lt;compiled_proto_definition_pb2.py&gt; &lt;MessageName&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ python3 json-generator.py test_app/addressbook_pb2.py AddressBook
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;people&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;id&#34;</span>: 1,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;phones&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;number&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;PHONE_TYPE_UNSPECIFIED&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;number&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;PHONE_TYPE_UNSPECIFIED&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;id&#34;</span>: 1,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;phones&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;number&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;PHONE_TYPE_UNSPECIFIED&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;number&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;PHONE_TYPE_UNSPECIFIED&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=what-about-existing-tooling>What about existing tooling?<a hidden class=anchor aria-hidden=true href=#what-about-existing-tooling>#</a></h2><p>I&rsquo;ve used the <code>blackboxprotobuf</code> <a href=https://github.com/nccgroup/blackboxprotobuf>Burp extension</a> for years, which aids in the decoding, editing, and re-encoding of Protobuf messages without known <code>.proto</code> files. For example, the figure below shows the Protobuf from above decoded by <code>blackboxprotobuf</code>.</p><figure><img loading=lazy src=/blackbox-protobuf-result.png alt="Blackboxprotobuf in action" height=400><figcaption><p>The Blackboxprotobuf extension in action</p></figcaption></figure><p>While it is an excellent tool, one of <code>blackboxprotobuf</code>&rsquo;s notable limitations is the fact that it can only send protobuf messages it has previously seen through Burp Suite&rsquo;s proxy. Sometimes, however, researchers want to send new protobuf messages, either because we want to fuzz them, or we know the format of a specific message.</p><p><code>ProtoBurp</code> solves two novel problems:</p><ol><li>The ability to send new protobuf messages that weren&rsquo;t already seen through proxy traffic</li><li>Operability with Burp Intruder and other extensions to fuzz protobuf inputs</li></ol><h1 id=protoburp-github-repository>ProtoBurp GitHub Repository<a hidden class=anchor aria-hidden=true href=#protoburp-github-repository>#</a></h1><p>You can access <code>ProtoBurp</code>, the JSON generator script, and a test application that accepts Protobufs <a href=https://github.com/dillonfranke/protoburp>here</a>. Detailed installation and usage instructions are also included.</p><p>Please submit any bugs or feature requests to <code>ProtoBurp</code>&rsquo;s <a href=https://github.com/dillonfranke/protoburp/issues>issue tracker</a>.</p><p>Thanks for reading, and I wish you much success testing Protobufs!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://www.dillonfrankesecurity.com/posts/java-static-vulnerability-analysis-to-increase-your-bounty/><span class=title>Next »</span><br><span>Java Static Vulnerability Analysis to Increase Your Bounty</span></a></nav></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//dillon-franke-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.dillonfrankesecurity.com>Dillon Franke Security</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>